# REFERENCES:
# Node: https://github.com/flathub/org.freedesktop.Sdk.Extension.node20/blob/branch/23.08/org.freedesktop.Sdk.Extension.node20.yaml
name: node
buildsystem: simple
config-opts:
  - --openssl-use-def-ca-store
  - --shared-openssl
  - --shared-zlib
  - --with-intl=system-icu
cleanup:
  - /lib/pkgconfig
  - /share/doc
  - /share/man
  - /share/systemtap
  - /lib/node_modules/npm/man
  - /lib/node_modules/npm/docs
build-commands:
  # Extract node to the app's tools directory
  - mkdir -p /app/scripture-app-builder/tools/node
  - tar -xvf node-v20.16.0-linux.tar.xz --strip-components=1 -C /app/scripture-app-builder/tools/node
  - export PATH=$PATH:/usr/lib/sdk/node20/bin
  - export npm_config_nodedir=/usr/lib/sdk/node20
sources:
  # Node .tar.xz archive
  # Any source can have either x86_64 or aarch64 specified so long
  # as the file 'flathub.json' is modified to include aarch64
  - type: file
    only-arches:
    - x86_64
    dest-filename: node-v20.16.0-linux.tar.xz
    url: https://nodejs.org/download/release/v20.16.0/node-v20.16.0-linux-x64.tar.xz
    sha256: c30af7dfea46de7d8b9b370fa33b8b15440bc93f0a686af8601bbb48b82f16c0
  - type: file
    only-arches:
    - aarch64
    dest-filename: node-v20.16.0-linux.tar.xz
    url: https://nodejs.org/dist/v20.16.0/node-v20.16.0-linux-arm64.tar.xz
    sha256: 1d9929e72f692179f884cd676b2dfabd879cb77defa7869dc8cfc802619277fb
